<html>
<head>
	<title>ortiz home temp monitor</title>
	<!-- inject:css -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" 
	  integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	  <link rel="stylesheet" href="../bower_components/angular-chart.js/dist/angular-chart.css">
    <!-- endinject -->
</head>
<body ng-app="tempMon">
	<div class="container">
		<h1>Aktuell</h1>
		<h1>Letzte Stunde</h1>	
		<div ng-controller="ChartController">
			<canvas id="line" class="chart chart-line" chart-data="data"
			  chart-labels="labels" chart-legend="true" chart-series="series"
			  chart-click="onClick" >
		</canvas> 
		</div>
	</div>
	
	<!-- inject:js -->
	<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" 
	  integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
	<script src="../bower_components/Chart.js/Chart.min.js"></script>
	<script src="../bower_components/angular-chart.js/dist/angular-chart.js"></script>
	<!-- endinject -->
	<script type="text/javascript">
		var tempMon = angular.module('tempMon', ['chart.js']);

		tempMon.controller('ChartController', ['$scope', 'TemperatureService', 
			function ($scope, TemperatureService) {

				TemperatureService.getData().then(function (messungen) {
					$scope.labels = messungen.labels;
					$scope.data = messungen.data;
					$scope.series = messungen.series;
				});

				$scope.onClick = function (points, evt) {
					console.log(points, evt);
				};
		}]);

		tempMon.service('TemperatureService', ['$http', '$q', function ($http, $q) {
			var service = {};

			service.url = 'http://home-ortiz.rhcloud.com/api/messungen';
			service.getData = function () 
			{
				return $http({ method: 'GET', url: this.url }).then(function (response) {
			    	// map data
			    	var messungen = {};
			    	messungen.labels = [];
			    	messungen.series = ['Wohnzimmer', 'Gefuehlt', 'Aussen'];
			    	messungen.data = [[], [], []];
					angular.forEach(response.data, function(value, key){
						var zeit = new Date(value.zeit);
						messungen.labels.push(zeit.getHours() + ":" + (zeit.getMinutes() < 10 ? "0" : "" ) + zeit.getMinutes());
						messungen.data[0].push(value.temperatur);
						messungen.data[1].push(value.temperatur_gefuehlt);
						messungen.data[2].push(value.temperatur_aussen);
					});

			    	return messungen;
			  	});
			}
			return service;
		}]);
	</script>
</body>
</html>